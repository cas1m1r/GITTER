======================: FILES :======================
Fail2ban-defence-nmap-and-botnet-scanning
├── 11-iptables.conf
├── example-iptables
├── iptables-ipset-proto6-allports.conf
├── iptables-logrotate.d
├── README.md
├── scanban-filter.conf
└── scanban-jail.conf

0 directories, 7 files
======================: README CONTENT :======================
Preventing, blocking, baning bots crawling and nmap scanning by ports in iptables

## Installation

Install iptables, ipset

Edit settings for iptables like in example-iptables file:
```
-A INPUT -p tcp -m tcp -j LOG --log-prefix "Iptables: unidentified: "
```
```
wget --no-check-certificate -O /etc/rsyslog.d/11-iptables.conf https://raw.githubusercontent.com/AndrewMarchukov/Fail2ban-defence-nmap-and-botnet-scanning/master/11-iptables.conf
wget --no-check-certificate -O /etc/fail2ban/action.d/iptables-ipset-proto6-allports.conf https://raw.githubusercontent.com/AndrewMarchukov/Fail2ban-defence-nmap-and-botnet-scanning/master/iptables-ipset-proto6-allports.conf
wget --no-check-certificate -O /etc/logrotate.d/iptables https://raw.githubusercontent.com/AndrewMarchukov/Fail2ban-defence-nmap-and-botnet-scanning/master/iptables-logrotate.d
wget --no-check-certificate -O /etc/fail2ban/filter.d/scanban-filter.conf https://raw.githubusercontent.com/AndrewMarchukov/Fail2ban-defence-nmap-and-botnet-scanning/master/scanban-filter.conf
wget --no-check-certificate -O /etc/fail2ban/jail.d/scanban-jail.conf https://raw.githubusercontent.com/AndrewMarchukov/Fail2ban-defence-nmap-and-botnet-scanning/master/scanban-jail.conf
```
and restart rsyslog, wait logs in /var/log/iptables.log then restart fail2ban

look blocked ip "ipset -L f2b-scanban"

## Tips and Tricks
Edit jail.conf:
```
[recidive]
enabled = true
logpath  = /var/log/fail2ban.log
banaction = iptables-ipset-proto6-allports
bantime  = 2592000
findtime = 86400   ; 1 day
maxretry = 3
```
Top 10 detected ip and port count:
```
cat /var/log/iptables.log| sed -r 's/.*SRC=(\S+).*PROTO=(\S+).*DPT=(\S+).*/\1 \2 \3/' | sort | uniq -c | sort -r -n|head -n 10
```
====================== GIT HISTORY: ======================
88d5103 HEAD@{0}: clone: from https://github.com/AndrewMarchukov/Fail2ban-defence-nmap-and-botnet-scanning
commit 88d51038e2a3440c178dc68b0d43282c6e55e2ab
Author: Andrew Marchukov <Jeklani@gmail.com>
Date:   Sun Feb 14 22:41:07 2021 +0300

    Update scanban-jail.conf

commit ee91daa6c87833c78b2fbde2e43b23fadd223239
Author: Andrew Marchukov <Jeklani@gmail.com>
Date:   Thu May 21 12:28:34 2020 +0300

    Update README.md

commit 50b8331fe58b5fe4d99fd947b121d7b03ca99fe2
Author: Andrew Marchukov <Jeklani@gmail.com>
Date:   Thu May 21 12:27:55 2020 +0300

    Update README.md

commit c2fa42cf7e6d5e2f21f961c39eabd7723392b8e1
Author: Andrew Marchukov <Jeklani@gmail.com>
Date:   Mon Dec 10 20:54:29 2018 +0400

    Update scanban-filter.conf

commit 25c391545f6046b783fc912768d299d2f9d32c60
Author: Andrew Marchukov <Jeklani@gmail.com>
Date:   Mon Dec 10 20:47:26 2018 +0400

    Update README.md
    
    Top 10 detected ip and port count

commit 128a9e81eef3d0610932e50e543a341dfd4bdec5
Author: Andrew Marchukov <Jeklani@gmail.com>
Date:   Mon Dec 10 16:02:22 2018 +0400

    Update README.md

commit 6c62480a25f11f28190192144c97e778f983fb90
Author: Andrew Marchukov <Jeklani@gmail.com>
Date:   Mon Dec 10 15:55:49 2018 +0400

    Create README.md

commit 07baa02e038bed6afca421ad6724b705c06000a7
Author: Andrew Marchukov <Jeklani@gmail.com>
Date:   Mon Dec 10 15:37:25 2018 +0400

    Create 11-iptables.conf
    
    /etc/rsyslog.d/11-iptables.conf

commit deb1ae4532ce2f35407368ad0683ed42b68278cb
Author: Andrew Marchukov <Jeklani@gmail.com>
Date:   Mon Dec 10 15:34:12 2018 +0400

    Create iptables-logrotate.d

commit 3771e528898f22f667b31bef26abd9ed00e2016b
Author: Andrew Marchukov <Jeklani@gmail.com>
Date:   Mon Dec 10 15:31:01 2018 +0400

    Create example-iptables

commit c8f0b87c503811d49b193a8c7ceeca230f380d0a
Author: Andrew Marchukov <Jeklani@gmail.com>
Date:   Mon Dec 10 15:25:42 2018 +0400

    Create iptables-ipset-proto6-allports.conf

commit e8711899a475d7148d42de9492d17e0a6fd5bd9b
Author: Andrew Marchukov <Jeklani@gmail.com>
Date:   Mon Dec 10 15:22:13 2018 +0400

    Rename scanban.conf to scanban-filter.conf

commit 1d7c00488f89bd209d2cc0672ddd8638784c93ca
Author: Andrew Marchukov <Jeklani@gmail.com>
Date:   Mon Dec 10 15:21:49 2018 +0400

    Create scanban-jail.conf

commit 58c4f93ea568f7cc9ef2b8d1038d1d667e3e1740
Author: Andrew Marchukov <Jeklani@gmail.com>
Date:   Mon Dec 10 15:20:19 2018 +0400

    Create scanban.conf

commit b157389c6d6709143855f77eb23f8048324b4167
Author: Andrew Marchukov <Jeklani@gmail.com>
Date:   Thu Mar 22 19:29:29 2018 +0300

    Delete LICENSE

commit 1f11fc8f2a3a1d22eb6b5f66627340988e17c157
Author: AndrewMarchukov <Jeklani@gmail.com>
Date:   Tue Sep 5 18:52:27 2017 +0300

    Create LICENSE
